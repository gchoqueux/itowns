<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>

<head>
    <title>Globe label</title>
    <link rel="stylesheet" type="text/css" href="css/example.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="js/GUI/dat.gui/dat.gui.min.js"></script>
</head>

<body>
    <div id="viewerDiv" class="viewer"></div>
    <script src="js/GUI/GuiTools.js"></script>
    <script src="../dist/itowns.js"></script>
    <script src="../dist/debug.js"></script>
    <script type="text/javascript">
        /* global itowns,document,GuiTools, debug, window */
        var position = { longitude: 2.351323, latitude: 48.856712, altitude: 25000 };

        // iTowns namespace defined here
        var viewerDiv = document.getElementById('viewerDiv');
        var view = new itowns.GlobeView(viewerDiv, position);
        var menuGlobe = new GuiTools('menuDiv', view);

        function createWMTSSourceFromConfig(config) {
            config.source = new itowns.WMTSSource(config.source);
            return config;
        }

        function addColorLayerFromConfig(config) {
            var layer = new itowns.ColorLayer(config.id, config);
            view.addLayer(layer).then(menuGlobe.addLayerGUI.bind(menuGlobe));
        }

        itowns.Fetcher.json('layers/JSONLayers/Ortho.json').then(createWMTSSourceFromConfig).then(addColorLayerFromConfig);

        function addElevationLayerFromConfig(config) {
            var layer = new itowns.ElevationLayer(config.id, config);
            view.addLayer(layer).then(menuGlobe.addLayerGUI.bind(menuGlobe));
        }

        itowns.Fetcher.json('layers/JSONLayers/WORLD_DTM.json')
            .then(createWMTSSourceFromConfig).then(addElevationLayerFromConfig);
        itowns.Fetcher.json('layers/JSONLayers/IGN_MNT_HIGHRES.json')
            .then(createWMTSSourceFromConfig).then(addElevationLayerFromConfig);

        // eslint-disable-next-line prefer-arrow-callback
        view.addEventListener(itowns.GLOBE_VIEW_EVENTS.GLOBE_INITIALIZED, function m() {
            // eslint-disable-next-line no-console
            console.info('Globe initialized');
            const c1 = new itowns.Coordinates('EPSG:4326', position.longitude + 0.01, position.latitude, 60);
            itowns.addCSS2DLabel(view, c1, 'css2d');

            const c2 = new itowns.Coordinates('EPSG:4326', position.longitude - 0.01, position.latitude, 200);
            itowns.sprite3D(view, c2);

            const c3 = new itowns.Coordinates('EPSG:4326', position.longitude, position.latitude + 0.01, 200);
            itowns.spriteHtml2canvas(view, c3, 'sprite Html2canvas');
        });

        const d = new debug.Debug(view, menuGlobe.gui);
        debug.createTileDebugUI(menuGlobe.gui, view, view.tileLayer, d);
        window.view = view;
    </script>
</body>

</html>